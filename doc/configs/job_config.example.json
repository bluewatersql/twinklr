{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Twinklr Job Configuration - Task-specific settings for a single sequence generation job",
  
  "schema_version": "3.0",
  
  "include_notes_track": true,
  "debug": true,
  "checkpoint": true,
  
  "assumptions": {
    "description": "Music theory assumptions for beat-aligned planning",
    "beats_per_bar": 4,
    "_comments": {
      "beats_per_bar": "Number of beats per measure (1-12). Common: 4 (4/4 time), 3 (3/4 waltz), 6 (6/8)"
    }
  },
  
  "fixture_config_path": "fixture_config.json",
  
  "planner": {
    "description": "LLM configuration for planning agent (overrides app config)",
    "model": "gpt-5.2",
    "temperature": 0.7,
    "_comments": {
      "model": "LLM model name - overrides app config if specified",
      "temperature": "LLM temperature (0.0-2.0) - overrides app config if specified",
      "_note": "Set to null to use app config defaults"
    }
  },
  
  "agent": {
    "description": "Multi-agent orchestration configuration for iterative plan refinement",
    "max_iterations": 3,
    "token_budget": 75000,
    "enforce_token_budget": false,
    "token_buffer_pct": 0.2,
    "success_threshold": 70,

    "plan_agent": {
      "description": "Agent that generates initial choreography plan",
      "model": "gpt-5.2",
      "temperature": 0.7,
      "max_tokens": 50000,
      "timeout_seconds": 60
    },

    "implementation_agent": {
      "description": "Agent that converts plan to detailed DMX instructions",
      "model": "gpt-5.2",
      "temperature": 0.7,
      "max_tokens": 50000,
      "timeout_seconds": 60
    },

    "judge_agent": {
      "description": "Agent that evaluates plan quality and provides feedback",
      "model": "gpt-5-mini",
      "temperature": 1.0,
      "max_tokens": 50000,
      "timeout_seconds": 60
    },

    "refinement_agent": {
      "description": "Agent that refines plan based on judge feedback",
      "model": "gpt-5.2",
      "temperature": 0.7,
      "max_tokens": 50000,
      "timeout_seconds": 60
    },

    "llm_logging": {
      "description": "LLM call logging for observability and debugging (Phase 0)",
      "enabled": true,
      "log_level": "standard",
      "format": "yaml",
      "sanitize": true,
      "_comments": {
        "enabled": "Enable/disable LLM call logging (set false for production performance)",
        "log_level": "Detail level: 'minimal' (metrics only), 'standard' (prompts + responses), 'full' (+ context)",
        "format": "Output format: 'yaml' (human-readable) or 'json' (machine-readable)",
        "sanitize": "Sanitize sensitive data (API keys, emails, etc.) from logs",
        "_env_overrides": "TWINKLR_DISABLE_LLM_LOGGING=1, TWINKLR_LLM_LOG_LEVEL=full, TWINKLR_LLM_LOG_FORMAT=json"
      }
    },

    "_comments": {
      "max_iterations": "Maximum judge/iterate loops (0=skip judge, just generate once)",
      "token_budget": "Total token budget for all agents across all iterations",
      "enforce_token_budget": "If true, hard stop when budget exceeded. If false, warn but continue",
      "token_buffer_pct": "Safety buffer for token predictions (0.2 = 20% buffer)",
      "success_threshold": "Minimum judge score (0-100) to accept plan without further iteration",
      "_workflow": "1) plan_agent generates plan, 2) judge_agent evaluates, 3) if score < threshold, refinement_agent improves, 4) repeat until threshold met or max_iterations reached"
    }
  },
  
  "output_dir": null,
  "project_name": null,
  
  "pose_config": {
    "description": "Semantic pose configuration - fixture-independent position abstraction",
    
    "custom_poses": {
      "description": "User-defined custom poses (added to standard poses)",
      "_example": {
        "STAGE_FRONT": {
          "pose_id": "STAGE_FRONT",
          "name": "Stage Front",
          "description": "Point at front edge of stage",
          "pan_deg": 0.0,
          "tilt_deg": -15.0
        },
        "BALCONY": {
          "pose_id": "BALCONY",
          "name": "Balcony",
          "description": "Point at balcony seating",
          "pan_deg": 0.0,
          "tilt_deg": 45.0
        }
      },
      "_comments": {
        "_note": "Custom poses are added to standard poses (FORWARD, LEFT_45, RIGHT_45, LEFT_90, RIGHT_90, UP, DOWN, CEILING, AUDIENCE_CENTER, AUDIENCE_LEFT, AUDIENCE_RIGHT)",
        "pan_deg": "Pan angle in degrees relative to forward (-180 to 180, 0=forward)",
        "tilt_deg": "Tilt angle in degrees relative to horizon (-90 to 90, 0=horizon, 90=up)"
      }
    },
    
    "pose_overrides": {
      "description": "Override standard pose definitions (e.g., adjust for rig orientation)",
      "_example": {
        "FORWARD": {
          "pose_id": "FORWARD",
          "name": "Forward",
          "description": "Adjusted forward for angled rig",
          "pan_deg": 15.0,
          "tilt_deg": 0.0
        }
      },
      "_comments": {
        "_note": "Use this to adjust standard poses for your specific rig orientation or venue layout"
      }
    }
  },
  
  "planner_features": {
    "description": "Feature flags for planner DMX channel control",
    "enable_shutter": true,
    "enable_color": true,
    "enable_gobo": true,
    "_comments": {
      "enable_shutter": "Allow planner to control shutter/strobe effects",
      "enable_color": "Allow planner to control color wheel",
      "enable_gobo": "Allow planner to control gobo patterns",
      "_note": "Pan/tilt/dimmer are always enabled. Disable features to simplify planning or reduce token usage"
    }
  },
  
  "channel_defaults": {
    "description": "Default channel states for entire sequence (unless overridden by agent plan)",
    "shutter": "open",
    "color": "white",
    "gobo": "open",
    "_comments": {
      "shutter": "Default shutter state. Options: open, closed, strobe_slow, strobe_medium, strobe_fast (depends on fixture shutter_map)",
      "color": "Default color preset. Options: white, red, orange, yellow, green, cyan, blue, magenta, open (depends on fixture color_map)",
      "gobo": "Default gobo pattern. Options: open, gobo1, gobo2, gobo3, gobo4 (depends on fixture gobo_map)",
      "_note": "These are fallback values. Agent plan can override per-section. Use fixture-specific preset names from fixture_config.json"
    }
  },
  
  "_usage": {
    "description": "How to use this configuration file",
    "location": "Save as 'job_config.json' in project root (or specify path with --job-config)",
    "validation": "Validated by JobConfig Pydantic model (packages/twinklr/core/config/models.py)",
    "schema_version": "Current schema version is 3.0 (adds pose_config, planner_features, channel_defaults)",
    "fixture_config": "Must reference a valid fixture configuration file (see fixture_config.example.json)",
    "forward_compatibility": "Unknown fields are ignored for forward compatibility"
  }
}
