# Choreography Plan Evaluation Request

Evaluate the following MacroPlan for quality and readiness.

## Song Context

- **Duration:** {{ audio_profile.song_identity.duration_ms }}ms ({{ (audio_profile.song_identity.duration_ms / 1000) | round(1) }}s)
{% if audio_profile.song_identity.bpm %}
- **BPM:** {{ audio_profile.song_identity.bpm | round(1) }}
{% endif %}
- **Overall Energy:** {{ audio_profile.energy_profile.macro_energy }}
- **Structure:** {{ audio_profile.structure.sections | length }} sections

## Plan to Evaluate

### Global Story
- **Theme:** {{ macro_plan.global_story.theme }}
- **Motifs:** {{ macro_plan.global_story.motifs | join(', ') }}
- **Pacing Notes:** {{ macro_plan.global_story.pacing_notes }}
- **Color Story:** {{ macro_plan.global_story.color_story }}

### Section Plans

{% for section in macro_plan.section_plans %}
{{ loop.index }}. **{{ section.section_name }}** ({{ section.section_id }})
   - Timing: {{ section.start_ms }}ms - {{ section.end_ms }}ms
   - Primary Focus Groups: {{ section.primary_focus_groups | join(', ') }}
{% if section.secondary_groups %}
   - Secondary Groups: {{ section.secondary_groups | join(', ') }}
{% endif %}
   - Choreography Style: {{ section.choreography_style }}
   - Motion Density: {{ section.motion_density }}
   - Energy Target: {{ section.energy_target }}
   - Layers: {{ section.layering_plan.layers | length }}
{% for layer in section.layering_plan.layers %}
     - Layer {{ layer.layer_index }}: {{ layer.intent }}
{% if layer.preferred_templates %}
       (Suggestions: {{ layer.preferred_templates | join(', ') }})
{% endif %}
{% endfor %}
{% if section.objectives %}
   - Objectives: {{ section.objectives | join('; ') }}
{% endif %}
{% if section.avoid %}
   - Avoid: {{ section.avoid | join(', ') }}
{% endif %}

{% endfor %}

### Global Constraints
- **Max Layers:** {{ macro_plan.global_constraints.max_layers }}
- **Default Blend Mode:** {{ macro_plan.global_constraints.default_blend_mode }}
- **Intensity Policy:** {{ macro_plan.global_constraints.intensity_policy }}

## AudioProfile Reference

### Per-Section Energy

{% for section_energy in audio_profile.energy_profile.section_profiles %}
**{{ section_energy.section_id }}**:
- Mean energy: {{ section_energy.mean_energy | round(2) }}
- Peak energy: {{ section_energy.peak_energy | round(2) }}
{% if section_energy.characteristics %}
- Characteristics: {{ section_energy.characteristics | join(', ') }}
{% endif %}

{% endfor %}

{% if audio_profile.planner_hints and audio_profile.planner_hints.section_objectives %}
### Planner Hints (Section Objectives)

{% for section_id, objectives in audio_profile.planner_hints.section_objectives.items() %}
**{{ section_id }}:** {{ objectives | join('; ') }}
{% endfor %}
{% endif %}

{% if iteration > 1 %}
---

## Iteration Context

**This is iteration {{ iteration }} of {{ max_iterations }}.**

{% if previous_issues %}
### Issues from Previous Iteration

{% for issue in previous_issues %}
- **{{ issue.issue_id }}** ({{ issue.severity }}): {{ issue.message }}
{% endfor %}

**Check if these issues have been addressed in the current plan.**
{% endif %}
{% endif %}

---

## Task

Evaluate this MacroPlan across four dimensions:

### 1. Musical Alignment (30%)
- Does the global story match the song's mood and energy?
- Do section energy targets match AudioProfile section characteristics?
- Does motion density align with section energy (SPARSE for low, BUSY for high)?
- Are key musical moments (drops, builds, peaks) highlighted appropriately?

### 2. Creative Quality (25%)
- Is the global story compelling and coherent?
- Are choreography styles appropriate for the song (imagery/abstract/hybrid)?
- Is there good variety in motion density and choreography style across sections?
- Are layer intents clear and purposeful?
- Are motifs recurring and thematically consistent?

### 3. Technical Feasibility (25%)
- Are display group selections reasonable and specific?
- Are layer intents clear and achievable?
- Does section timing match AudioProfile exactly?
- Is coverage complete (no gaps or overlaps)?
- Are layer counts appropriate (1-3)?

### 4. Strategic Coherence (20%)
- Is there a clear, unified vision across all sections?
- Do section plans support the global story?
- Is the pacing and flow well-considered?
- Are transitions between sections thoughtful?
- Does the plan have a clear beginning, middle, and end?

---

## Output Requirements

Provide a **JudgeVerdict** with:

1. **status**: APPROVE, SOFT_FAIL, or HARD_FAIL
2. **score**: Weighted average (0.0-10.0)
3. **confidence**: Your confidence in this evaluation (0.0-1.0)
4. **score_breakdown**: Scores for each dimension
5. **strengths**: List of specific strengths (2-5 items)
6. **issues**: List of Issue objects (if any)
7. **overall_assessment**: 2-3 sentence summary
8. **feedback_for_planner**: Specific, actionable feedback

**Remember:**
- Be specific and actionable in feedback
- Acknowledge strengths even in SOFT_FAIL/HARD_FAIL
- Use stable issue_id values for tracking
- Justify decisions in terms of serving the music and the Christmas light show theme
- Calculate weighted score correctly
- Focus on high-level strategy, not implementation details