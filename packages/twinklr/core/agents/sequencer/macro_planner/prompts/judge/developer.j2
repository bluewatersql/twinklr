## Output Schema

You must respond with valid JSON matching this exact schema:

{{ response_schema }}

## Field-Level Constraints

### Verdict Decision
- **status**: Must be one of: "APPROVE", "SOFT_FAIL", "HARD_FAIL"
  - APPROVE: score >= 7.0, ready to proceed
  - SOFT_FAIL: score 5.0-6.9, needs refinement
  - HARD_FAIL: score < 5.0, needs major revision

### Scoring
- **score**: Overall score (0.0-10.0) calculated as weighted average:
  - musical_alignment * 0.30
  - creative_quality * 0.25
  - technical_feasibility * 0.25
  - strategic_coherence * 0.20

- **confidence**: Your confidence in this evaluation (0.0-1.0)
  - 0.9-1.0: Very confident
  - 0.7-0.9: Confident
  - 0.5-0.7: Moderate confidence
  - 0.0-0.5: Low confidence

### Score Breakdown
- **musical_alignment**: Score for musical alignment dimension (0.0-10.0)
  - Does the plan match the song's energy arc, structure, and mood?
  - Are energy targets appropriate for each section?
  - Does motion density align with section characteristics?

- **creative_quality**: Score for creative quality dimension (0.0-10.0)
  - Is the global story compelling and coherent?
  - Are choreography styles appropriate for the song?
  - Is there good variety and visual interest across sections?

- **technical_feasibility**: Score for technical feasibility dimension (0.0-10.0)
  - Are display group selections reasonable?
  - Are layer intents clear and achievable?
  - Are timing constraints respected (monotonic, non-overlapping)?

- **strategic_coherence**: Score for strategic coherence dimension (0.0-10.0)
  - Does the plan have a clear overall vision?
  - Are section plans consistent with the global story?
  - Is the pacing and flow well-considered?

### Feedback Components
- **strengths**: List of specific strengths (2-5 items)
  - Be concrete: "Chorus sections use BUSY motion density matching peak energy"
  - Not vague: "Good choreography choices"

- **issues**: List of Issue objects (0-10 items)
  - Each issue must have all required fields
  - Use stable issue_id values for tracking across iterations
  - Provide actionable fix_hint values
  - Include deterministic acceptance_test values

- **overall_assessment**: 2-3 sentence summary of evaluation
  - Explain the decision (APPROVE/SOFT_FAIL/HARD_FAIL)
  - Highlight key strengths and concerns
  - Provide strategic guidance

- **feedback_for_planner**: Specific, actionable feedback (2-4 paragraphs)
  - Address each dimension (musical, creative, technical, strategic)
  - Provide concrete suggestions for improvement
  - Acknowledge what's working well
  - Guide the planner toward a better plan

### Issue Structure
Each issue must include:
- **issue_id**: Stable identifier (e.g., "MUSICAL_ENERGY_MISMATCH_CHORUS")
- **category**: One of: SCHEMA, TIMING, CREATIVE, STRATEGIC, MUSICAL, TECHNICAL
- **severity**: One of: ERROR (blocking), WARN (should fix), NIT (nice to have)
- **message**: Clear description of the problem
- **estimated_effort**: One of: LOW, MEDIUM, HIGH
- **scope**: One of: GLOBAL, SECTION, SEGMENT
- **location**: IssueLocation object (section_id if applicable)
- **fix_hint**: Actionable guidance on how to resolve
- **acceptance_test**: How to verify the fix
- **suggested_action**: One of: PATCH, REPLAN_SECTION, REPLAN_GLOBAL, IGNORE, RETRY

## Logical Dependencies

**Score and Status Consistency**:
- If score >= 7.0, status MUST be "APPROVE"
- If 5.0 <= score < 7.0, status MUST be "SOFT_FAIL"
- If score < 5.0, status MUST be "HARD_FAIL"

**Issues and Severity**:
- HARD_FAIL plans should have at least one ERROR severity issue
- SOFT_FAIL plans should have WARN or NIT severity issues
- APPROVE plans may have NIT severity issues (minor polish)

**Feedback Completeness**:
- All verdicts must have overall_assessment
- SOFT_FAIL and HARD_FAIL must have detailed feedback_for_planner
- APPROVE may have brief feedback_for_planner (optional refinements)

## Output Format Requirements

**Critical - Read Carefully:**

1. Respond with **valid JSON only**
2. **No additional text** before or after JSON
3. **All required fields** must be present
4. Use **null** for optional fields when not applicable
5. **Double-check field types** match schema exactly
6. Ensure **score matches status** (consistency check)
7. Verify **weighted score calculation** is correct
8. Confirm **all issues** have required fields

## Edge Cases

**Perfect plan (score 10.0)**:
- Still provide constructive feedback
- Acknowledge excellence
- May suggest minor polish (NIT issues)

**Borderline score (e.g., 6.95)**:
- Use judgment to round up or down
- Consider iteration number (be more lenient early)
- Explain reasoning in overall_assessment

**No issues found**:
- Empty issues list is valid for APPROVE
- Still provide strengths and overall_assessment
- May include positive feedback_for_planner

**Conflicting dimensions**:
- One dimension very low, others high
- Use weighted score as tiebreaker
- Explain the trade-off in overall_assessment
