{#
GroupPlanner Developer Prompt - TECHNICAL CONSTRAINTS ONLY
See system.j2 for recipes and guidelines
#}
## Response Schema

Return a `SectionCoordinationPlan` matching this schema:

```json
{{ response_schema }}
```

## Enum Values (Use Exactly)

{% if taxonomy %}
- **LaneKind:** {{ taxonomy.LaneKind | join(', ') }}
- **CoordinationMode:** {{ taxonomy.CoordinationMode | join(', ') }}
- **IntensityLevel:** {{ taxonomy.IntensityLevel | join(', ') }}
- **EffectDuration:** {{ taxonomy.EffectDuration | join(', ') }}
- **StepUnit:** {{ taxonomy.StepUnit | join(', ') }}
{% else %}
- **LaneKind:** BASE, RHYTHM, ACCENT
- **CoordinationMode:** UNIFIED, COMPLEMENTARY, SEQUENCED, CALL_RESPONSE, RIPPLE
- **IntensityLevel:** WHISPER, SOFT, MED, STRONG, PEAK
- **EffectDuration:** HIT, BURST, PHRASE, EXTENDED, SECTION
- **StepUnit:** BEATS, BARS
{% endif %}

## Hard Constraints (Validation Failures)

| Constraint | Rule | Example Violation |
|------------|------|-------------------|
| Lane-Template Match | gtpl_base_* → BASE only | Using gtpl_rhythm_* in BASE lane |
| No Duplicate group_order | Each group once | ["HERO_1", "HERO_1", "HERO_2"] |
| group_order ⊆ group_ids | All group_order in group_ids | group_order has HERO_3, group_ids missing it |
| Window for SEQUENCED | Must have window + config | SEQUENCED mode with only placements |
| Start within bounds | bar 1 to available_bars | bar 10 when section has 4 bars |
| No mixed approach | Window OR placements per group | HERO_1 in window AND in placements same lane |
| No invented group_ids | `group_ids` ⊆ available groups | `group_ids` includes an ID not present in `display_graph.groups[].group_id` |
| No invented template_ids | every `template_id` ∈ template catalog | placement uses `template_id` not present in the template catalog |
| UNIFIED covers all groups | UNIFIED requires **1 placement per `group_id`** | `group_ids` has N groups but placements only cover < N group_ids |
| No within-lane overlap (placements) | For same lane+group_id: [start,end) intervals must be disjoint | accent_a: (bar2 beat1..bar2 beat3) overlaps accent_b: (bar2 beat2..bar2 beat4) |


## SEQUENCED Mode Requirements

```json
{
  "coordination_mode": "SEQUENCED",
  "group_ids": ["ARCHES_1", "ARCHES_2", "ARCHES_3"],
  "window": {
    "template_id": "gtpl_rhythm_chase_single",
    "start": {"bar": 1, "beat": 1},
    "end": {"bar": 4, "beat": 1},
    "intensity": "STRONG"
  },
  "config": {
    "group_order": ["ARCHES_1", "ARCHES_2", "ARCHES_3"],
    "step_unit": "BEATS",
    "step_duration": 2
  }
}
```

**Window sizing:** duration >= group_count × step_duration

## UNIFIED Mode (Placements)

```json
{
  "coordination_mode": "UNIFIED",
  "group_ids": ["OUTLINE_1", "OUTLINE_2", "OUTLINE_3"],
  "placements": [
    {
      "placement_id": "base_outline_glow_1",
      "group_id": "OUTLINE_1",
      "template_id": "gtpl_base_glow_warm",
      "start": {"bar": 1, "beat": 1},
      "duration": "SECTION",
      "intensity": "SOFT"
    },
    {
      "placement_id": "base_outline_glow_2",
      "group_id": "OUTLINE_2",
      "template_id": "gtpl_base_glow_warm",
      "start": {"bar": 1, "beat": 1},
      "duration": "SECTION",
      "intensity": "SOFT"
    },
    {
      "placement_id": "base_outline_glow_3",
      "group_id": "OUTLINE_3",
      "template_id": "gtpl_base_glow_warm",
      "start": {"bar": 1, "beat": 1},
      "duration": "SECTION",
      "intensity": "SOFT"
    }
  ]
}
```
> **Example correctness requirement:** If `group_ids` contains multiple groups, UNIFIED output must include one placement per group (unless wildcard is supported). Do not provide a single placement and assume it broadcasts.

**Note:** UNIFIED requires placements for **each** `group_id` (same timing/template/intensity).

## Timing Format

```json
{"bar": 1, "beat": 1}  // Section-relative (bar 1 = section start)
```

- Bars: 1 to available_bars (see user prompt)
- Beats: 1 to 4 (assuming 4/4)
- Duration: HIT, BURST, PHRASE, EXTENDED, SECTION
