{"role": "user", "content": "Section: chorus_1 (HIGH energy, BUSY motion, ABSTRACT style)\nPrimary targets: HERO\nBounds: 48.0s to 64.0s\n\nThemeRef (COPY EXACTLY):\n{\n  \"theme_id\": \"theme.holiday.traditional\",\n  \"scope\": \"SECTION\",\n  \"tags\": [\"celebratory\"],\n  \"palette_id\": null\n}\n\nPalette (COPY EXACTLY):\n{\n  \"palette_id\": \"core.christmas_traditional\",\n  \"role\": \"PRIMARY\",\n  \"intensity\": 1.0\n}\n\nMotif IDs (COPY EXACTLY): sparkles, bells, starburst\n\nCreate coordination plan."}
{"role": "assistant", "content": "{\n  \"section_id\": \"chorus_1\",\n  \"theme\": {\n    \"theme_id\": \"theme.holiday.traditional\",\n    \"scope\": \"SECTION\",\n    \"tags\": [\"celebratory\"],\n    \"palette_id\": null\n  },\n  \"palette\": {\n    \"palette_id\": \"core.christmas_traditional\",\n    \"role\": \"PRIMARY\",\n    \"intensity\": 1.0\n  },\n  \"motif_ids\": [\"sparkles\", \"bells\", \"starburst\"],\n  \"lane_plans\": [\n    {\n      \"lane\": \"BASE\",\n      \"target_roles\": [\"OUTLINE\"],\n      \"timing_driver\": \"BARS\",\n      \"blend_mode\": \"alpha_over\",\n      \"coordination_plans\": [\n        {\n          \"coordination_mode\": \"UNIFIED\",\n          \"group_ids\": [\"OUTLINE_1\", \"OUTLINE_2\", \"OUTLINE_3\"],\n          \"placements\": [\n            {\n              \"placement_id\": \"chorus_base_shimmer\",\n              \"group_id\": \"OUTLINE_1\",\n              \"template_id\": \"gtpl_base_shimmer_radial\",\n              \"start\": {\"kind\": \"BAR_BEAT\", \"bar\": 1, \"beat\": 1},\n              \"end\": {\"kind\": \"BAR_BEAT\", \"bar\": 5, \"beat\": 1},\n              \"intensity\": 0.85\n            }\n          ]\n        }\n      ]\n    },\n    {\n      \"lane\": \"RHYTHM\",\n      \"target_roles\": [\"ARCHES\"],\n      \"timing_driver\": \"BEATS\",\n      \"blend_mode\": \"add\",\n      \"coordination_plans\": [\n        {\n          \"coordination_mode\": \"SEQUENCED\",\n          \"group_ids\": [\"ARCHES_1\", \"ARCHES_2\", \"ARCHES_3\"],\n          \"window\": {\n            \"template_id\": \"gtpl_rhythm_chase_single\",\n            \"start\": {\"kind\": \"BAR_BEAT\", \"bar\": 1, \"beat\": 1},\n            \"end\": {\"kind\": \"BAR_BEAT\", \"bar\": 5, \"beat\": 1}\n          },\n          \"config\": {\n            \"group_order\": [\"ARCHES_1\", \"ARCHES_2\", \"ARCHES_3\"],\n            \"step_unit\": \"BEATS\",\n            \"step_duration\": 1\n          }\n        }\n      ]\n    },\n    {\n      \"lane\": \"ACCENT\",\n      \"target_roles\": [\"HERO\"],\n      \"timing_driver\": \"PHRASES\",\n      \"blend_mode\": \"max\",\n      \"coordination_plans\": [\n        {\n          \"coordination_mode\": \"UNIFIED\",\n          \"group_ids\": [\"HERO_1\", \"HERO_2\", \"HERO_3\"],\n          \"placements\": [\n            {\n              \"placement_id\": \"chorus_hero_burst\",\n              \"group_id\": \"HERO_1\",\n              \"template_id\": \"gtpl_accent_burst_big\",\n              \"start\": {\"kind\": \"BAR_BEAT\", \"bar\": 1, \"beat\": 1},\n              \"end\": {\"kind\": \"BAR_BEAT\", \"bar\": 2, \"beat\": 1},\n              \"intensity\": 1.18\n            }\n          ]\n        }\n      ]\n    }\n  ],\n  \"deviations\": []\n}\n\n✓ VALID: Theme copied exactly (scope=SECTION), palette copied exactly (core.christmas_traditional), motif_ids copied exactly (sparkles, bells, starburst). Layer hierarchy maintained. Intensity within limits."}
{"role": "user", "content": "What's wrong with this plan?\n\n{\n  \"section_id\": \"verse_1\",\n  \"theme\": {\n    \"theme_id\": \"MISSING\",\n    \"scope\": \"SECTION\",\n    \"tags\": []\n  },\n  \"palette\": {\n    \"palette_id\": \"UNSPECIFIED_FROM_MACROPLAN\"\n  },\n  \"motif_ids\": [],\n  \"lane_plans\": [...]\n}"}
{"role": "assistant", "content": "❌ INVALID: Using placeholders instead of copying provided values!\n\nProblems:\n1. **theme.theme_id = \"MISSING\"**: You MUST copy the exact theme_id from the ThemeRef shown in the user prompt\n2. **palette.palette_id = \"UNSPECIFIED_FROM_MACROPLAN\"**: You MUST copy the exact palette_id from the palette JSON shown\n3. **motif_ids = []**: You MUST copy the exact motif_ids list from the MacroPlan section\n\nThese values are PROVIDED in the user prompt - never use placeholders!\n\nFix: Look at the user prompt for:\n- \"ThemeRef (COPY EXACTLY)\" section → copy theme object\n- \"Palette (COPY EXACTLY)\" section → copy palette object  \n- \"Motif IDs (COPY EXACTLY)\" section → copy motif_ids array\n\nIf any of these are truly missing from the prompt, ask for them - don't use placeholders."}
{"role": "user", "content": "What's wrong with this plan?\n\n{\n  \"section_id\": \"verse_1\",\n  \"theme\": {\"theme_id\": \"theme.holiday.traditional\"},\n  \"lane_plans\": [\n    {\n      \"lane\": \"RHYTHM\",\n      \"coordination_plans\": [\n        {\n          \"coordination_mode\": \"UNIFIED\",\n          \"group_ids\": [\"ARCHES_1\", \"ARCHES_2\"],\n          \"placements\": [{\"start\": {\"bar\": 1}, \"end\": {\"bar\": 5}}]\n        },\n        {\n          \"coordination_mode\": \"COMPLEMENTARY\",\n          \"group_ids\": [\"ARCHES_1\", \"ARCHES_3\"],\n          \"placements\": [{\"start\": {\"bar\": 1}, \"end\": {\"bar\": 5}}]\n        }\n      ]\n    }\n  ]\n}"}
{"role": "assistant", "content": "❌ INVALID: Multiple errors!\n\n1. **Theme missing scope**: theme MUST include \"scope\": \"SECTION\" (required field, not optional)\n2. **Missing palette**: palette field is required - copy from provided palette_ref_json\n3. **Missing motif_ids**: motif_ids field is required - copy from provided MacroPlan motif list\n4. **Within-lane overlap**: ARCHES_1 appears in TWO coordination_plans in RHYTHM lane with same timing (bars 1-5) - this creates a conflict\n\nFix: Add scope to theme, copy palette and motif_ids from prompt, and fix overlap by removing ARCHES_1 from one plan OR making timing sequential."}
{"role": "user", "content": "What intensity should I use for a BUILD section with HIGH energy targeting HERO groups?"}
{"role": "assistant", "content": "For BUILD section with HIGH energy:\n\n**Layer Hierarchy (intensity increases with each layer):**\n- BASE on OUTLINE: 0.75-0.85 (foundation)\n- RHYTHM on ARCHES: 0.95-1.05 (motion support)\n- ACCENT on HERO: 1.15-1.25 (focal highlight)\n\n**Key principles:**\n1. ACCENT should be ~0.2-0.3 higher than RHYTHM\n2. PRIMARY targets (HERO) get ACCENT lane\n3. HIGH energy = upper range intensities (but not at max limits)\n4. BUILD sections increase intensity toward section end\n\n**STRICT LIMITS** (exceeding = validation failure):\n- BASE max: 1.10\n- RHYTHM max: 1.20  \n- ACCENT max: 1.30\n\nExample:\n```json\n{\"placement_id\": \"hero_build\", \"group_id\": \"HERO_1\", \"template_id\": \"gtpl_accent_pulse_hard\", \"intensity\": 1.22}\n```"}
{"role": "user", "content": "What's wrong with this template selection?\n\n{\n  \"lane\": \"BASE\",\n  \"coordination_plans\": [{\n    \"placements\": [{\n      \"template_id\": \"gtpl_rhythm_strobe_soft\",\n      \"intensity\": 0.8\n    }]\n  }]\n}"}
{"role": "assistant", "content": "❌ INVALID: Template lane mismatch!\n\nProblem: Using gtpl_rhythm_strobe_soft (RHYTHM template) in BASE lane.\n\nTemplates must match their lane:\n- BASE lane → gtpl_base_* templates only\n- RHYTHM lane → gtpl_rhythm_* templates only\n- ACCENT lane → gtpl_accent_* templates only\n\nCheck the template_catalog entry's \"compatible_lanes\" field before assigning.\n\nFix: Use a BASE template like gtpl_base_shimmer_radial or gtpl_base_glow_warm"}
{"role": "user", "content": "What's wrong with these ACCENT placements?\n\n{\n  \"lane\": \"ACCENT\",\n  \"coordination_plans\": [{\n    \"coordination_mode\": \"UNIFIED\",\n    \"group_ids\": [\"HERO_1\", \"HERO_2\", \"HERO_3\", \"MEGA_TREE_1\"],\n    \"placements\": [\n      {\"group_id\": \"HERO_1\", \"template_id\": \"gtpl_accent_burst_big\", \"start\": {\"bar\": 2, \"beat\": 1}, \"end\": {\"bar\": 2, \"beat\": 3}, \"intensity\": 1.25},\n      {\"group_id\": \"HERO_2\", \"template_id\": \"gtpl_accent_burst_big\", \"start\": {\"bar\": 2, \"beat\": 1}, \"end\": {\"bar\": 2, \"beat\": 3}, \"intensity\": 1.24},\n      {\"group_id\": \"HERO_3\", \"template_id\": \"gtpl_accent_burst_big\", \"start\": {\"bar\": 2, \"beat\": 1}, \"end\": {\"bar\": 2, \"beat\": 3}, \"intensity\": 1.23},\n      {\"group_id\": \"MEGA_TREE_1\", \"template_id\": \"gtpl_accent_burst_big\", \"start\": {\"bar\": 2, \"beat\": 1}, \"end\": {\"bar\": 2, \"beat\": 3}, \"intensity\": 1.22}\n    ]\n  }]\n}"}
{"role": "assistant", "content": "❌ PROBLEMATIC: Peak Competition / Simultaneous Accents!\n\nProblem: ALL 4 groups hit high-intensity accents (1.22-1.25) at the EXACT same time (bar 2, beat 1). This creates visual competition with no clear focal point.\n\n**Issues:**\n1. Same template on all groups (no variety)\n2. Same timing on all groups (no stagger)\n3. Nearly identical intensities (no hero/secondary differentiation)\n\n**Fix - Option A (Stagger timing):**\n```json\n{\"group_id\": \"HERO_1\", \"start\": {\"bar\": 2, \"beat\": 1}, \"intensity\": 1.25},\n{\"group_id\": \"HERO_2\", \"start\": {\"bar\": 2, \"beat\": 2}, \"intensity\": 1.15},\n{\"group_id\": \"HERO_3\", \"start\": {\"bar\": 2, \"beat\": 3}, \"intensity\": 1.12},\n{\"group_id\": \"MEGA_TREE_1\", \"start\": {\"bar\": 3, \"beat\": 1}, \"intensity\": 1.20}\n```\n\n**Fix - Option B (Use SEQUENCED mode):**\nLet the assembler auto-stagger with a window + config.\n\n**Key principle:** Keep ONE group as the hero with highest intensity; stagger others by 1+ beat."}
{"role": "user", "content": "What's wrong with this BASE layer?\n\n{\n  \"lane\": \"BASE\",\n  \"coordination_plans\": [\n    {\n      \"group_ids\": [\"OUTLINE_1\", \"OUTLINE_2\", \"OUTLINE_3\"],\n      \"placements\": [\n        {\"group_id\": \"OUTLINE_1\", \"template_id\": \"gtpl_base_shimmer_radial\", \"intensity\": 0.75},\n        {\"group_id\": \"OUTLINE_2\", \"template_id\": \"gtpl_base_shimmer_radial\", \"intensity\": 0.75},\n        {\"group_id\": \"OUTLINE_3\", \"template_id\": \"gtpl_base_shimmer_radial\", \"intensity\": 0.75}\n      ]\n    },\n    {\n      \"group_ids\": [\"WINDOWS_1\", \"WINDOWS_2\", \"WINDOWS_3\"],\n      \"placements\": [\n        {\"group_id\": \"WINDOWS_1\", \"template_id\": \"gtpl_base_shimmer_radial\", \"intensity\": 0.75},\n        {\"group_id\": \"WINDOWS_2\", \"template_id\": \"gtpl_base_shimmer_radial\", \"intensity\": 0.75},\n        {\"group_id\": \"WINDOWS_3\", \"template_id\": \"gtpl_base_shimmer_radial\", \"intensity\": 0.75}\n      ]\n    }\n  ]\n}"}
{"role": "assistant", "content": "⚠️ WARN: Variety Issue - Repeated BASE Template!\n\nProblem: ALL 6 groups use the EXACT same template (gtpl_base_shimmer_radial) with identical intensity (0.75). This creates a monotonous, uniform look.\n\n**Issues:**\n1. Same template across all OUTLINE and WINDOWS groups\n2. Same intensity on all placements\n3. No visual differentiation between group roles\n\n**Fix - Vary templates across roles:**\n```json\n// OUTLINE groups - one template\n{\"group_id\": \"OUTLINE_1\", \"template_id\": \"gtpl_base_shimmer_radial\", \"intensity\": 0.72},\n{\"group_id\": \"OUTLINE_2\", \"template_id\": \"gtpl_base_shimmer_radial\", \"intensity\": 0.75},\n{\"group_id\": \"OUTLINE_3\", \"template_id\": \"gtpl_base_shimmer_radial\", \"intensity\": 0.78},\n\n// WINDOWS groups - different template\n{\"group_id\": \"WINDOWS_1\", \"template_id\": \"gtpl_base_glow_warm\", \"intensity\": 0.80},\n{\"group_id\": \"WINDOWS_2\", \"template_id\": \"gtpl_base_glow_warm\", \"intensity\": 0.78},\n{\"group_id\": \"WINDOWS_3\", \"template_id\": \"gtpl_base_glow_warm\", \"intensity\": 0.76}\n```\n\n**Key principle:** Use at least 2 different templates across groups, or vary intensity/param_overrides to create visual interest."}
{"role": "user", "content": "What's wrong with these timing settings?\n\n{\n  \"lane_plans\": [\n    {\n      \"lane\": \"BASE\",\n      \"timing_driver\": \"BARS\",\n      \"placements\": [{\"snap_rule\": \"BAR\", ...}]\n    },\n    {\n      \"lane\": \"RHYTHM\",\n      \"timing_driver\": \"BEATS\",\n      \"placements\": [{\"snap_rule\": \"BEAT\", ...}]\n    },\n    {\n      \"lane\": \"ACCENT\",\n      \"timing_driver\": \"LYRICS\",\n      \"placements\": [{\"snap_rule\": \"BAR\", ...}]\n    }\n  ]\n}"}
{"role": "assistant", "content": "⚠️ WARN: Timing Mismatch Risk!\n\nProblem: ACCENT lane has timing_driver=LYRICS but placements use snap_rule=BAR. This mismatch can cause accents to drift from lyric cues.\n\n**Issue breakdown:**\n- BASE: timing_driver=BARS, snap_rule=BAR ✅ (aligned)\n- RHYTHM: timing_driver=BEATS, snap_rule=BEAT ✅ (aligned)\n- ACCENT: timing_driver=LYRICS, snap_rule=BAR ❌ (mismatch!)\n\n**Alignment rules:**\n| timing_driver | Recommended snap_rule |\n|---------------|----------------------|\n| BARS          | BAR                  |\n| BEATS         | BEAT                 |\n| LYRICS        | BEAT (for lyric hits)|\n\n**Fix:** Change ACCENT snap_rule to BEAT:\n```json\n{\n  \"lane\": \"ACCENT\",\n  \"timing_driver\": \"LYRICS\",\n  \"placements\": [{\"snap_rule\": \"BEAT\", ...}]\n}\n```\n\n**Key principle:** Match snap_rule to timing_driver. LYRICS driver uses BEAT snap since lyrics land on beats, not bar boundaries."}
